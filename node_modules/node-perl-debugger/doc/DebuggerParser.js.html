<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: DebuggerParser.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: DebuggerParser.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

var TransformStream = require("stream").Transform,
    util = require("util");

var DebuggerVariableParser = require("./DebuggerVariableParser"),
    DebuggerStackTraceParser = require("./DebuggerStackTraceParser"),
    Logger = require("./logger"),
    StreamEmitter = require("./StreamEmitter");

util.inherits(DebuggerParser, TransformStream);
StreamEmitter.mixin(DebuggerParser);

module.exports = DebuggerParser;

DebuggerParser.SCAN_MODE = "scan";
DebuggerParser.VARIABLE_PARSE_MODE = "variable-parse";
DebuggerParser.STACK_TRACE_PARSE_MODE = "stacktrace-parse";

/**
 * Parses text from the Perl debugger into events.
 *
 * @param {ParserConfiguration} [config]
 * @constructor
 * @private
 */
function DebuggerParser(config) {
  TransformStream.call(this, { objectMode: true });

  this._mode = DebuggerParser.SCAN_MODE;
  this._logger = Logger.initLogger(config);

  /** @type {DebuggerVariableParser} */
  this._variableParser = new DebuggerVariableParser(config);
  this._variableParser.on("readable", this._eventProxy(this._variableParser));

  /** @type {DebuggerStackTraceParser} */
  this._stackTraceParser = new DebuggerStackTraceParser(config);
  this._stackTraceParser.on("readable", this._eventProxy(this._stackTraceParser));
}

DebuggerParser.prototype.getMode = function() {
  return this._mode;
};

DebuggerParser.prototype.setMode = function(mode) {
  this._mode = mode;

  if (this._mode === DebuggerParser.VARIABLE_PARSE_MODE) {
    this._logger("Beginning variable parse");
    this._variableParser.reset();
  }

  if (this._mode === DebuggerParser.STACK_TRACE_PARSE_MODE) {
    this._logger("Beginning stacktrace parse");
    this._stackTraceParser.reset();
  }
};

//noinspection JSUnusedGlobalSymbols
DebuggerParser.prototype._transform = function(chunk, encoding, done) {
  switch (this._mode) {
    case DebuggerParser.VARIABLE_PARSE_MODE:
      this._variableParser.write(chunk, encoding);
        break;

    case DebuggerParser.STACK_TRACE_PARSE_MODE:
      this._stackTraceParser.write(chunk, encoding);
      break;

    default:
      chunk.split("\n").forEach(this._scan.bind(this));
  }

  done();
};

//noinspection JSUnusedGlobalSymbols
DebuggerParser.prototype._flush = function(done) {
  if (this._mode === DebuggerParser.VARIABLE_PARSE_MODE) {
    this._variableParser.end();
  }

  done();
};

DebuggerParser.prototype._scan = function(line) {
  var matches;

  matches = /^.*::.*\((.*):(\d+)\):/.exec(line);
  if (matches &amp;&amp; matches.length > 0) {
    return this._event("break", matches[1], matches[2]);
  }

  matches = /\s*DB&lt;(\d+)>\s*$/.exec(line);
  if (matches &amp;&amp; matches.length > 0) {
    return this._event("prompt", matches[1]);
  }

  if (/Debugged program terminated/.test(line)) {
    return this._event("terminated");
  }

  matches = /No file matching '(.*)' is loaded/.exec(line);
  if (matches &amp;&amp; matches.length > 0) {
    return this._event("filenotfound", matches[1]);
  }

  matches = /Line (\d+) of '.*' not breakable/.exec(line);
  if (matches &amp;&amp; matches.length > 0) {
    return this._event("notbreakable", matches[1]);
  }
};

DebuggerParser.prototype._eventProxy = function(readable) {
  return function() {
    this._mode = DebuggerParser.SCAN_MODE;
    this.push(readable.read());
  }.bind(this);
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DebuggerCommands.html">DebuggerCommands</a></li><li><a href="DebuggerHost.html">DebuggerHost</a></li><li><a href="DebuggerParser.html">DebuggerParser</a></li><li><a href="DebuggerStackTraceParser.html">DebuggerStackTraceParser</a></li><li><a href="DebuggerVariableParser.html">DebuggerVariableParser</a></li><li><a href="Parser.html">Parser</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Wed Aug 19 2015 23:31:27 GMT+1000 (AEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
